# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'untitled.ui'
#
# Created by: PyQt5 UI code generator 5.15.9
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.


from PyQt5 import QtCore, QtGui, QtWidgets

from PacketGen import PacketGen
from decor import except_catch

class Ui_PacketGen(object):
    def setupUi(self, PacketGen):
        PacketGen.setObjectName("PacketGen")
        PacketGen.resize(1154, 623)
        self.centralwidget = QtWidgets.QWidget(PacketGen)
        self.centralwidget.setEnabled(True)
        self.centralwidget.setObjectName("centralwidget")
        self.Packet_view = QtWidgets.QTableView(self.centralwidget)
        self.Packet_view.setGeometry(QtCore.QRect(10, 10, 381, 421))
        self.Packet_view.setObjectName("Packet_view")
        self.data_view = QtWidgets.QListView(self.centralwidget)
        self.data_view.setGeometry(QtCore.QRect(10, 440, 381, 121))
        self.data_view.setObjectName("data_view")
        self.label = QtWidgets.QLabel(self.centralwidget)
        self.label.setGeometry(QtCore.QRect(400, 480, 331, 101))
        font = QtGui.QFont()
        font.setFamily("Microsoft YaHei")
        font.setPointSize(48)
        self.label.setFont(font)
        self.label.setObjectName("label")
        self.label_5 = QtWidgets.QLabel(self.centralwidget)
        self.label_5.setGeometry(QtCore.QRect(740, 530, 141, 51))
        font = QtGui.QFont()
        font.setPointSize(13)
        self.label_5.setFont(font)
        self.label_5.setObjectName("label_5")
        self.label_6 = QtWidgets.QLabel(self.centralwidget)
        self.label_6.setGeometry(QtCore.QRect(790, 0, 121, 16))
        self.label_6.setObjectName("label_6")
        self.create = QtWidgets.QPushButton(self.centralwidget)
        self.create.setGeometry(QtCore.QRect(950, 440, 171, 121))
        self.create.setObjectName("create")
        self.int_list = QtWidgets.QComboBox(self.centralwidget)
        self.int_list.setGeometry(QtCore.QRect(780, 20, 221, 22))
        self.int_list.setObjectName("int_list")
        self.int_list.addItem("")
        self.bob = QtWidgets.QTabWidget(self.centralwidget)
        self.bob.setGeometry(QtCore.QRect(400, 240, 731, 181))
        self.bob.setObjectName("bob")
        self.icmp = QtWidgets.QWidget()
        self.icmp.setToolTip("")
        self.icmp.setObjectName("icmp")
        self.gridLayoutWidget = QtWidgets.QWidget(self.icmp)
        self.gridLayoutWidget.setGeometry(QtCore.QRect(60, 30, 541, 73))
        self.gridLayoutWidget.setObjectName("gridLayoutWidget")
        self.icmp_layout = QtWidgets.QGridLayout(self.gridLayoutWidget)
        self.icmp_layout.setContentsMargins(0, 0, 0, 0)
        self.icmp_layout.setObjectName("icmp_layout")
        self.icmp_code_box = QtWidgets.QCheckBox(self.gridLayoutWidget)
        self.icmp_code_box.setObjectName("icmp_code_box")
        self.icmp_layout.addWidget(self.icmp_code_box, 0, 2, 1, 1)
        self.icmp_id_box = QtWidgets.QCheckBox(self.gridLayoutWidget)
        self.icmp_id_box.setObjectName("icmp_id_box")
        self.icmp_layout.addWidget(self.icmp_id_box, 0, 4, 1, 1)
        self.icmp_code_text = QtWidgets.QPlainTextEdit(self.gridLayoutWidget)
        self.icmp_code_text.setObjectName("icmp_code_text")
        self.icmp_layout.addWidget(self.icmp_code_text, 0, 3, 1, 1)
        self.icmp_type_text = QtWidgets.QTextEdit(self.gridLayoutWidget)
        self.icmp_type_text.setObjectName("icmp_type_text")
        self.icmp_layout.addWidget(self.icmp_type_text, 0, 1, 1, 1)
        self.label_11 = QtWidgets.QLabel(self.gridLayoutWidget)
        self.label_11.setObjectName("label_11")
        self.icmp_layout.addWidget(self.label_11, 0, 0, 1, 1)
        self.icmp_id_text = QtWidgets.QTextEdit(self.gridLayoutWidget)
        self.icmp_id_text.setObjectName("icmp_id_text")
        self.icmp_layout.addWidget(self.icmp_id_text, 0, 5, 1, 1)
        self.bob.addTab(self.icmp, "")
        self.TCP = QtWidgets.QWidget()
        self.TCP.setObjectName("TCP")
        self.tcp_data_text_edit = QtWidgets.QTextEdit(self.TCP)
        self.tcp_data_text_edit.setGeometry(QtCore.QRect(0, 0, 311, 151))
        self.tcp_data_text_edit.setObjectName("tcp_data_text_edit")
        self.verticalLayoutWidget_2 = QtWidgets.QWidget(self.TCP)
        self.verticalLayoutWidget_2.setGeometry(QtCore.QRect(480, 30, 201, 71))
        self.verticalLayoutWidget_2.setObjectName("verticalLayoutWidget_2")
        self.flags_layout = QtWidgets.QVBoxLayout(self.verticalLayoutWidget_2)
        self.flags_layout.setContentsMargins(0, 0, 0, 0)
        self.flags_layout.setObjectName("flags_layout")
        self.gridLayout = QtWidgets.QGridLayout()
        self.gridLayout.setObjectName("gridLayout")
        self.FIN = QtWidgets.QCheckBox(self.verticalLayoutWidget_2)
        self.FIN.setObjectName("FIN")
        self.gridLayout.addWidget(self.FIN, 1, 2, 1, 1)
        self.PSH = QtWidgets.QCheckBox(self.verticalLayoutWidget_2)
        self.PSH.setObjectName("PSH")
        self.gridLayout.addWidget(self.PSH, 1, 1, 1, 1)
        self.ACK = QtWidgets.QCheckBox(self.verticalLayoutWidget_2)
        self.ACK.setObjectName("ACK")
        self.gridLayout.addWidget(self.ACK, 2, 0, 1, 1)
        self.ECN = QtWidgets.QCheckBox(self.verticalLayoutWidget_2)
        self.ECN.setObjectName("ECN")
        self.gridLayout.addWidget(self.ECN, 2, 2, 1, 1)
        self.SYN = QtWidgets.QCheckBox(self.verticalLayoutWidget_2)
        self.SYN.setObjectName("SYN")
        self.gridLayout.addWidget(self.SYN, 1, 0, 1, 1)
        self.RST = QtWidgets.QCheckBox(self.verticalLayoutWidget_2)
        self.RST.setObjectName("RST")
        self.gridLayout.addWidget(self.RST, 2, 1, 1, 1)
        self.URG = QtWidgets.QCheckBox(self.verticalLayoutWidget_2)
        self.URG.setObjectName("URG")
        self.gridLayout.addWidget(self.URG, 1, 3, 1, 1)
        self.CWR = QtWidgets.QCheckBox(self.verticalLayoutWidget_2)
        self.CWR.setObjectName("CWR")
        self.gridLayout.addWidget(self.CWR, 2, 3, 1, 1)
        self.label_7 = QtWidgets.QLabel(self.verticalLayoutWidget_2)
        self.label_7.setAlignment(QtCore.Qt.AlignCenter)
        self.label_7.setObjectName("label_7")
        self.gridLayout.addWidget(self.label_7, 0, 0, 1, 4)
        self.flags_layout.addLayout(self.gridLayout)
        self.tcp_dst_port = QtWidgets.QLineEdit(self.TCP)
        self.tcp_dst_port.setGeometry(QtCore.QRect(400, 30, 61, 16))
        self.tcp_dst_port.setObjectName("tcp_dst_port")
        self.label_18 = QtWidgets.QLabel(self.TCP)
        self.label_18.setGeometry(QtCore.QRect(330, 30, 47, 13))
        self.label_18.setObjectName("label_18")
        self.tcp_seq = QtWidgets.QLineEdit(self.TCP)
        self.tcp_seq.setGeometry(QtCore.QRect(392, 60, 81, 20))
        self.tcp_seq.setObjectName("tsp_seq")
        self.tcp_ack = QtWidgets.QLineEdit(self.TCP)
        self.tcp_ack.setGeometry(QtCore.QRect(392, 90, 81, 20))
        self.tcp_ack.setObjectName("tcp_ack")
        self.tcp_window = QtWidgets.QLineEdit(self.TCP)
        self.tcp_window.setGeometry(QtCore.QRect(392, 120, 81, 20))
        self.tcp_window.setObjectName("tcp_window")
        self.tcp_src_port = QtWidgets.QLineEdit(self.TCP)
        self.tcp_src_port.setGeometry(QtCore.QRect(400, 10, 61, 16))
        self.tcp_src_port.setObjectName("tcp_src_port")
        self.label_21 = QtWidgets.QLabel(self.TCP)
        self.label_21.setGeometry(QtCore.QRect(330, 10, 71, 16))
        self.label_21.setObjectName("label_21")
        self.label_22 = QtWidgets.QLabel(self.TCP)
        self.label_22.setGeometry(QtCore.QRect(330, 60, 47, 13))
        self.label_22.setObjectName("label_22")
        self.label_23 = QtWidgets.QLabel(self.TCP)
        self.label_23.setGeometry(QtCore.QRect(330, 90, 47, 13))
        self.label_23.setObjectName("label_23")
        self.label_24 = QtWidgets.QLabel(self.TCP)
        self.label_24.setGeometry(QtCore.QRect(330, 120, 61, 16))
        self.label_24.setObjectName("label_24")
        self.bob.addTab(self.TCP, "")
        self.UDP = QtWidgets.QWidget()
        self.UDP.setObjectName("UDP")
        self.udp_data_text = QtWidgets.QTextEdit(self.UDP)
        self.udp_data_text.setGeometry(QtCore.QRect(0, 0, 441, 151))
        self.udp_data_text.setObjectName("udp_data_text")
        self.udp_src_port = QtWidgets.QLineEdit(self.UDP)
        self.udp_src_port.setGeometry(QtCore.QRect(530, 30, 113, 20))
        self.udp_src_port.setObjectName("udp_src_port")
        self.udp_dst_port = QtWidgets.QLineEdit(self.UDP)
        self.udp_dst_port.setGeometry(QtCore.QRect(530, 60, 113, 20))
        self.udp_dst_port.setObjectName("udp_dst_port")
        self.label_19 = QtWidgets.QLabel(self.UDP)
        self.label_19.setGeometry(QtCore.QRect(460, 30, 71, 16))
        self.label_19.setObjectName("label_19")
        self.label_20 = QtWidgets.QLabel(self.UDP)
        self.label_20.setGeometry(QtCore.QRect(470, 60, 47, 13))
        self.label_20.setObjectName("label_20")
        self.bob.addTab(self.UDP, "")
        self.gridLayoutWidget_2 = QtWidgets.QWidget(self.centralwidget)
        self.gridLayoutWidget_2.setGeometry(QtCore.QRect(470, 70, 545, 150))
        self.gridLayoutWidget_2.setObjectName("gridLayoutWidget_2")
        self.config_ip_mac = QtWidgets.QGridLayout(self.gridLayoutWidget_2)
        self.config_ip_mac.setSizeConstraint(QtWidgets.QLayout.SetMinimumSize)
        self.config_ip_mac.setContentsMargins(0, 0, 0, 0)
        self.config_ip_mac.setObjectName("config_ip_mac")
        self.label_2 = QtWidgets.QLabel(self.gridLayoutWidget_2)
        self.label_2.setObjectName("label_2")
        self.config_ip_mac.addWidget(self.label_2, 0, 6, 1, 1)
        self.ip_src_box = QtWidgets.QCheckBox(self.gridLayoutWidget_2)
        self.ip_src_box.setObjectName("ip_src_box")
        self.config_ip_mac.addWidget(self.ip_src_box, 1, 0, 1, 1)
        self.label_4 = QtWidgets.QLabel(self.gridLayoutWidget_2)
        self.label_4.setObjectName("label_4")
        self.config_ip_mac.addWidget(self.label_4, 1, 4, 1, 1)
        self.ip_dst_box = QtWidgets.QCheckBox(self.gridLayoutWidget_2)
        self.ip_dst_box.setObjectName("ip_dst_box")
        self.config_ip_mac.addWidget(self.ip_dst_box, 1, 2, 1, 1)
        self.mac_src_box = QtWidgets.QCheckBox(self.gridLayoutWidget_2)
        self.mac_src_box.setObjectName("mac_src_box")
        self.config_ip_mac.addWidget(self.mac_src_box, 0, 0, 1, 1)
        self.dts_mac_box = QtWidgets.QCheckBox(self.gridLayoutWidget_2)
        self.dts_mac_box.setObjectName("dts_mac_box")
        self.config_ip_mac.addWidget(self.dts_mac_box, 0, 3, 1, 1)
        self.label_3 = QtWidgets.QLabel(self.gridLayoutWidget_2)
        self.label_3.setObjectName("label_3")
        self.config_ip_mac.addWidget(self.label_3, 1, 6, 1, 1)
        self.ip_src_text = QtWidgets.QTextEdit(self.gridLayoutWidget_2)
        self.ip_src_text.setObjectName("ip_src_text")
        self.config_ip_mac.addWidget(self.ip_src_text, 1, 1, 1, 1)
        self.ip_dst_text = QtWidgets.QTextEdit(self.gridLayoutWidget_2)
        self.ip_dst_text.setObjectName("ip_dst_text")
        self.config_ip_mac.addWidget(self.ip_dst_text, 1, 3, 1, 1)
        self.ip_id_text = QtWidgets.QTextEdit(self.gridLayoutWidget_2)
        self.ip_id_text.setObjectName("ip_id_text")
        self.config_ip_mac.addWidget(self.ip_id_text, 1, 5, 1, 1)
        self.ip_ttl_text = QtWidgets.QTextEdit(self.gridLayoutWidget_2)
        self.ip_ttl_text.setObjectName("ip_ttl_text")
        self.config_ip_mac.addWidget(self.ip_ttl_text, 1, 7, 1, 1)
        self.mac_proto_text = QtWidgets.QTextEdit(self.gridLayoutWidget_2)
        self.mac_proto_text.setObjectName("mac_proto_text")
        self.config_ip_mac.addWidget(self.mac_proto_text, 0, 7, 1, 1)
        self.mac_dst_text = QtWidgets.QTextEdit(self.gridLayoutWidget_2)
        self.mac_dst_text.setObjectName("mac_dst_text")
        self.config_ip_mac.addWidget(self.mac_dst_text, 0, 4, 1, 2)
        self.mac_src_text = QtWidgets.QTextEdit(self.gridLayoutWidget_2)
        self.mac_src_text.setObjectName("mac_src_text")
        self.config_ip_mac.addWidget(self.mac_src_text, 0, 1, 1, 2)
        self.label_8 = QtWidgets.QLabel(self.centralwidget)
        self.label_8.setGeometry(QtCore.QRect(420, 170, 47, 13))
        self.label_8.setObjectName("label_8")
        self.label_9 = QtWidgets.QLabel(self.centralwidget)
        self.label_9.setGeometry(QtCore.QRect(420, 100, 47, 13))
        self.label_9.setObjectName("label_9")
        self.just_ip = QtWidgets.QCheckBox(self.centralwidget)
        self.just_ip.setGeometry(QtCore.QRect(640, 440, 231, 17))
        self.just_ip.setObjectName("just_ip")
        PacketGen.setCentralWidget(self.centralwidget)
        self.menubar = QtWidgets.QMenuBar(PacketGen)
        self.menubar.setGeometry(QtCore.QRect(0, 0, 1154, 21))
        self.menubar.setObjectName("menubar")
        PacketGen.setMenuBar(self.menubar)
        self.statusbar = QtWidgets.QStatusBar(PacketGen)
        self.statusbar.setObjectName("statusbar")
        PacketGen.setStatusBar(self.statusbar)

        self.retranslateUi(PacketGen)
        self.bob.setCurrentIndex(0)
        QtCore.QMetaObject.connectSlotsByName(PacketGen)
        self.handlerCreate()

    def retranslateUi(self, PacketGen):
        _translate = QtCore.QCoreApplication.translate
        PacketGen.setWindowTitle(_translate("PacketGen", "PacketGen"))
        self.label.setText(_translate("PacketGen", "PacketGen"))
        self.label_5.setText(_translate("PacketGen", "created by Rubick"))
        self.label_6.setText(_translate("PacketGen", "Select Interface       :"))
        self.create.setText(_translate("PacketGen", "Create"))
        self.int_list.setItemText(0, _translate("PacketGen", "default: Ethernet"))
        self.icmp_code_box.setText(_translate("PacketGen", "Code"))
        self.icmp_id_box.setText(_translate("PacketGen", "ID"))
        self.label_11.setText(_translate("PacketGen", "Type :"))
        self.bob.setTabText(self.bob.indexOf(self.icmp), _translate("PacketGen", "ICMP"))
        self.FIN.setText(_translate("PacketGen", "FIN"))
        self.PSH.setText(_translate("PacketGen", "PSH"))
        self.ACK.setText(_translate("PacketGen", "ACK"))
        self.ECN.setText(_translate("PacketGen", "ECN"))
        self.SYN.setText(_translate("PacketGen", "SYN"))
        self.RST.setText(_translate("PacketGen", "RST"))
        self.URG.setText(_translate("PacketGen", "URG"))
        self.CWR.setText(_translate("PacketGen", "CWR"))
        self.label_7.setText(_translate("PacketGen", "Flags"))
        self.label_18.setText(_translate("PacketGen", "Dst port"))
        self.label_21.setText(_translate("PacketGen", "Source port"))
        self.label_22.setText(_translate("PacketGen", "seq"))
        self.label_23.setText(_translate("PacketGen", "ack"))
        self.label_24.setText(_translate("PacketGen", "window size"))
        self.bob.setTabText(self.bob.indexOf(self.TCP), _translate("PacketGen", "TCP"))
        self.label_19.setText(_translate("PacketGen", "Source port"))
        self.label_20.setText(_translate("PacketGen", "Dst port"))
        self.bob.setTabText(self.bob.indexOf(self.UDP), _translate("PacketGen", "UDP"))
        self.label_2.setText(_translate("PacketGen", "Протокол:"))
        self.ip_src_box.setText(_translate("PacketGen", "SRC:"))
        self.ip_id_text.setText(_translate("PacketGen", "13555"))
        self.ip_ttl_text.setText(_translate("PacketGen", "56"))
        self.label_4.setText(_translate("PacketGen", "ИД:"))
        self.ip_dst_box.setText(_translate("PacketGen", "DST:"))
        self.mac_src_box.setText(_translate("PacketGen", "SRC:"))
        self.dts_mac_box.setText(_translate("PacketGen", "DST:"))
        self.label_3.setText(_translate("PacketGen", "T T L"))
        self.label_8.setText(_translate("PacketGen", "L3:"))
        self.label_9.setText(_translate("PacketGen", "L2:"))
        self.just_ip.setText(_translate("PacketGen", "may be just send IP packet?"))


    def handlerCreate(self):
        self.create.clicked.connect(lambda: self.createPacket())

    def getFlags(self) -> str:
        flags: str = ''
        if self.SYN.isChecked():
            flags += 'S'
        if self.RST.isChecked():
            flags += 'R'
        if self.URG.isChecked():
            flags += 'U'
        if self.ACK.isChecked():
            flags += 'A'
        if self.ECN.isChecked():
            flags += 'E'
        if self.CWR.isChecked():
            flags += 'C'
        if self.PSH.isChecked():
            flags += 'P'
        if self.FIN.isChecked():
            flags += 'F'
        return flags


    @except_catch
    def createPacket(self) -> None:
        temp = PacketGen()
        ip_layer= None
        kwargs: dict[str, str | int] = dict()
        kwargs['src'] =  self.ip_src_text.toPlainText()
        kwargs['dst'] = self.ip_dst_text.toPlainText()
        kwargs['id_ip'] = int(self.ip_id_text.toPlainText())
        kwargs['ttl'] = int(self.ip_ttl_text.toPlainText())
        kwargs = {k: v for k, v in kwargs.items() if len(str(v))}
        ip_layer = temp.getIpPacket(**kwargs)

        if self.just_ip.isChecked():
            temp.sendPacket(ip_layer)

        elif self.icmp.isVisible():
            kwargs.clear()
            kwargs['type'] = self.icmp_type_text.toPlainText()
            kwargs['code'] = self.icmp_code_text.toPlainText()
            kwargs['id'] = self.icmp_id_text.toPlainText()
            kwargs = {k: int(v) for k, v in kwargs.items() if len(v)}

            icmp_layer = temp.getIcmpPacket(**kwargs)
            temp.sendPacket(ip_layer,icmp_layer)
        elif self.TCP.isVisible():
            kwargs.clear()
            kwargs['sport'] = self.tcp_src_port.text()
            kwargs['dport'] = self.tcp_dst_port.text()
            kwargs['seq'] = self.tcp_seq.text()
            kwargs['ack'] = self.tcp_ack.text()
            kwargs['window'] = self.tcp_window.text()
            kwargs = {k : int(v) for k,v in kwargs.items() if len(v)}

            kwargs['payload'] = self.tcp_data_text_edit.toPlainText()
            kwargs['flags'] = self.getFlags()

            tcp_layer = temp.getTcpPacket(**kwargs)
            temp.sendPacket(ip_layer,tcp_layer)
        elif self.UDP.isVisible():
            kwargs.clear()
            kwargs['sport'] = self.udp_src_port.text()
            kwargs['dport'] = self.udp_dst_port.text()
            kwargs = {k: int(v) for k, v in kwargs.items() if len(v)}
            kwargs['payload'] = self.udp_data_text.toPlainText()

            udp_layer = temp.getUdpPacket(**kwargs)
            temp.sendPacket(ip_layer,udp_layer)


if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    PacketGenWin = QtWidgets.QMainWindow()
    ui = Ui_PacketGen()
    ui.setupUi(PacketGenWin)
    PacketGenWin.show()
    sys.exit(app.exec_())


